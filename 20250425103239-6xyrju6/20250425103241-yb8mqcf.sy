{"ID":"20250425103241-yb8mqcf","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250425103241-yb8mqcf","title":"内存","type":"doc","updated":"20250425111214"},"Children":[{"ID":"20250425103241-bw9swrt","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250425103241-bw9swrt","updated":"20250425111214"},"Children":[{"Type":"NodeText","Data":"FAT32 格式的 SD 卡用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"write()"},{"Type":"NodeText","Data":"​ 写文件时，内核的 page cache 缓存持续增长，且不会主动释放，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"O_SYNC"},{"Type":"NodeText","Data":"​ 也无效"}]},{"ID":"20250425110309-xqvh81s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250425110309-xqvh81s","updated":"20250425111214"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YWJhcA=="},{"Type":"NodeCodeBlockCode","Data":"\nopen(path, O_RDWR | O_CREAT | O_TRUNC | O_SYNC | O_DIRECT, 0777);  读写|创建|覆盖|无缓存|绕过page cache直接写\n\nO_DIRECT常用于数据库或高性能服务器，暂时不用\n\nfsync(fd)；保存\n\nposix_fadvise(pvideo-\u003estream_fd, offset, len, POSIX_FADV_DONTNEED);清缓存 offset=0,len=0 从头开始，所有长度\n\nPOSIX_FADV_NORMAL应用程序会以常规的方式访问文件\n\nPOSIX_FADV_RANDOM表明应用程序会以随机的顺序访问文件内核会减少文件的预读操作\n\nPOSIX_FADV_SEQUENTIAL表示应用程序会按顺序访问文件，从文件开头到结尾依次读取。内核会根据这个建议增加文件的预读量，提前将后续可能要访问的数据加载到缓存中，以提高文件读取的性能\n\nPOSIX_FADV_WILLNEED通知内核，应用程序在不久的将来会访问从 offset 开始的 len 字节的数据。内核会尝试提前将这些数据加载到缓存中，以减少后续访问时的 I/O 延迟\n\nPOSIX_FADV_NOREUSE告知内核，应用程序只会访问一次从 offset 开始的 len 字节的数据，之后不会再次访问。内核可以根据这个建议，在数据被访问后及时释放相关的缓存资源\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250425110317-cs2wkn5","Type":"NodeParagraph","Properties":{"id":"20250425110317-cs2wkn5","updated":"20250425110317"}}]}