"use strict";var ye=Object.defineProperty;var ve=(t,e,n)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(ve(t,typeof e!="symbol"?e+"":e,n),n);const H=require("siyuan"),z=(t,e,n)=>{const i=e??"zhi",s=o=>{const c=o.getFullYear(),d=String(o.getMonth()+1).padStart(2,"0"),_=String(o.getDate()).padStart(2,"0"),v=String(o.getHours()).padStart(2,"0"),p=String(o.getMinutes()).padStart(2,"0"),k=String(o.getSeconds()).padStart(2,"0");return`${c}-${d}-${_} ${v}:${p}:${k}`},a=(o,c,d)=>{const _=s(new Date);d?console.log(`[${i}] [${_}] [${o}] [${t}] ${c}`,d):console.log(`[${i}] [${_}] [${o}] [${t}] ${c}`)},l=(o,c)=>{const d=s(new Date);c?console.info(`[${i}] [${d}] [INFO] [${t}] ${o}`,c):console.info(`[${i}] [${d}] [INFO] [${t}] ${o}`)},r=(o,c)=>{const d=s(new Date);c?console.warn(`[${i}] [${d}] [WARN] [${t}] ${o}`,c):console.warn(`[${i}] [${d}] [WARN] [${t}] ${o}`)},g=(o,c)=>{const d=s(new Date);c?console.error(typeof o=="string"?`[${i}] [${d}] [ERROR] [${t}] ${o}`:`[${i}] [${d}] [ERROR] [${t}] ${o.toString()}`,c):typeof o=="string"?console.error(`[${i}] [${d}] [ERROR] [${t}] ${o.toString()}`):console.error(`[${i}] [${d}] [ERROR] [${t}] an error occurred =>`,o)};return{debug:(o,c)=>{n&&a("DEBUG",o,c)},info:(o,c)=>{l(o,c)},warn:(o,c)=>{r(o,c)},error:(o,c)=>{g(o,c)}}};function C(){}function ce(t){return t()}function ie(){return Object.create(null)}function F(t){t.forEach(ce)}function re(t){return typeof t=="function"}function de(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function $e(t){return Object.keys(t).length===0}function u(t,e){t.appendChild(e)}function ue(t,e,n){t.insertBefore(e,n||null)}function Q(t){t.parentNode&&t.parentNode.removeChild(t)}function h(t){return document.createElement(t)}function ke(t){return document.createTextNode(t)}function x(){return ke(" ")}function P(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function xe(t){return Array.from(t.childNodes)}function j(t,e,n){for(let i=0;i<t.options.length;i+=1){const s=t.options[i];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function se(t){const e=t.querySelector(":checked");return e&&e.__value}let q;function A(t){q=t}function Se(){if(!q)throw new Error("Function called outside component initialization");return q}function ge(t){Se().$$.on_mount.push(t)}const G=[],oe=[];let I=[];const le=[],Ee=Promise.resolve();let X=!1;function Le(){X||(X=!0,Ee.then(he))}function B(t){I.push(t)}const W=new Set;let R=0;function he(){if(R!==0)return;const t=q;do{try{for(;R<G.length;){const e=G[R];R++,A(e),Ce(e.$$)}}catch(e){throw G.length=0,R=0,e}for(A(null),G.length=0,R=0;oe.length;)oe.pop()();for(let e=0;e<I.length;e+=1){const n=I[e];W.has(n)||(W.add(n),n())}I.length=0}while(G.length);for(;le.length;)le.pop()();X=!1,W.clear(),A(t)}function Ce(t){if(t.fragment!==null){t.update(),F(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(B)}}function Te(t){const e=[],n=[];I.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),I=e}const De=new Set;function Me(t,e){t&&t.i&&(De.delete(t),t.i(e))}function Oe(t,e,n,i){const{fragment:s,after_update:a}=t.$$;s&&s.m(e,n),i||B(()=>{const l=t.$$.on_mount.map(ce).filter(re);t.$$.on_destroy?t.$$.on_destroy.push(...l):F(l),t.$$.on_mount=[]}),a.forEach(B)}function Pe(t,e){const n=t.$$;n.fragment!==null&&(Te(n.after_update),F(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Re(t,e){t.$$.dirty[0]===-1&&(G.push(t),Le(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function fe(t,e,n,i,s,a,l,r=[-1]){const g=q;A(t);const o=t.$$={fragment:null,ctx:[],props:a,update:C,not_equal:s,bound:ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:ie(),dirty:r,skip_bound:!1,root:e.target||g.$$.root};l&&l(o.root);let c=!1;if(o.ctx=n?n(t,e.props||{},(d,_,...v)=>{const p=v.length?v[0]:_;return o.ctx&&s(o.ctx[d],o.ctx[d]=p)&&(!o.skip_bound&&o.bound[d]&&o.bound[d](p),c&&Re(t,d)),_}):[],o.update(),c=!0,F(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const d=xe(e.target);o.fragment&&o.fragment.l(d),d.forEach(Q)}else o.fragment&&o.fragment.c();e.intro&&Me(t.$$.fragment),Oe(t,e.target,e.anchor,e.customElement),he()}A(g)}class pe{$destroy(){Pe(this,1),this.$destroy=C}$on(e,n){if(!re(n))return C;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!$e(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}`${window.siyuan.config.system.workspaceDir}`;`${window.siyuan.config.system.dataDir}`;const J=!1,Ge="",me="";class _e{constructor(e){m(this,"logger");m(this,"prop");m(this,"current");m(this,"elements");this.logger=z("pio","kanban-girl",J),this.prop=e,this.current={idol:0,timeout:void 0,menu:document.querySelector(".pio-container .pio-action"),canvas:document.getElementById("pio"),body:document.querySelector(".pio-container"),root:document.location.protocol+"//"+document.location.hostname+"/"},this.elements={home:this.create("span",{class:"pio-home"}),skin:this.create("span",{class:"pio-skin"}),info:this.create("span",{class:"pio-info"}),night:this.create("span",{class:"pio-night"}),close:this.create("span",{class:"pio-close"}),dialog:this.create("div",{class:"pio-dialog"}),show:this.create("div",{class:"pio-show"})},this.current.body.appendChild(this.elements.dialog),this.current.body.appendChild(this.elements.show),window.console&&window.console.log&&console.log("%c Pio %c https://paugram.com ","color: #fff; margin: 1em 0; padding: 5px 0; background: #673ab7;","margin: 1em 0; padding: 5px 0; background: #efefef;")}start(){this.init(),this.elements.show.onclick=()=>{this.show()},this.logger.info("Kanban Girl is ready, haha~")}autoDisplay(){localStorage.getItem("posterGirl")==="0"?this.show():this.hide()}init(e){if(!this.prop.hidden){if(!e){const n=window;this.action_welcome(),n.loadlive2d("pio",this.prop.model[0])}switch(this.prop.mode){case"static":this.begin_static();break;case"fixed":this.begin_fixed();break;case"draggable":this.begin_draggable();break}this.prop.content.custom&&this.action_custom()}}initHidden(){this.prop.mode==="draggable"&&(this.current.body.style.top=null,this.current.body.style.left=null,this.current.body.style.bottom=null),this.current.body.classList.add("hidden"),this.elements.dialog.classList.remove("active")}hide(){this.modules_destroy(),localStorage.setItem("posterGirl","0")}show(){this.current.body.classList.remove("hidden"),localStorage.setItem("posterGirl","1"),this.init()}begin_static(){this.current.body.classList.add("static")}begin_fixed(){this.action_touch(),this.action_buttons()}begin_draggable(){this.action_touch(),this.action_buttons();const e=this.current.body,n={x:0,y:0},i=l=>{const{offsetLeft:r,offsetTop:g}=l.currentTarget;n.x=l.clientX-r,n.y=l.clientY-g,document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)},s=l=>{e.classList.add("active"),e.classList.remove("right"),e.style.left=l.clientX-n.x+"px",e.style.top=l.clientY-n.y+"px",e.style.bottom="auto"},a=()=>{e.classList.remove("active"),document.removeEventListener("mousemove",s)};e.onmousedown=i}modules_idol(){return this.current.idol<this.prop.model.length-1?this.current.idol++:this.current.idol=0,this.current.idol}modules_message(e,n={}){const{dialog:i}=this.elements;e.constructor===Array?i.innerText=this.rand(e):e.constructor===String?i[n.html?"innerHTML":"innerText"]=e:i.innerText="输入内容出现问题了 X_X",i.classList.add("active"),clearTimeout(this.current.timeout),this.current.timeout=setTimeout(()=>{i.classList.remove("active")},n.time||3e3)}modules_destroy(){this.initHidden()}action_welcome(){if(document.referrer&&document.referrer.includes(this.current.root)){const e=document.createElement("a");e.href=document.referrer,this.prop.content.referer?this.modules_message(this.prop.content.referer.replace(/%t/,`“${e.hostname}”`)):this.modules_message(`欢迎来自 “${e.hostname}” 的朋友！`)}else if(this.prop.tips){let e;const n=new Date().getHours();n>22||n<=5?e="你是夜猫子呀？这么晚还不睡觉，明天起的来嘛":n>5&&n<=8?e="早上好！":n>8&&n<=11?e="上午好！工作顺利嘛，不要久坐，多起来走动走动哦！":n>11&&n<=14?e="中午了，工作了一个上午，现在是午餐时间！":n>14&&n<=17?e="午后很容易犯困呢，今天的运动目标完成了吗？":n>17&&n<=19?e="傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红~":n>19&&n<=21?e="晚上好，今天过得怎么样？":n>21&&n<=23?e="已经这么晚了呀，早点休息吧，晚安~":e="奇趣保罗说：这个是无法被触发的吧，哈哈",this.modules_message(e)}else this.modules_message(this.prop.content.welcome||"欢迎来到本站！")}action_touch(){this.current.canvas.onclick=()=>{this.modules_message(this.prop.content.touch||["你在干什么？","再摸我就报警了！","不可以这样欺负我啦！"])}}action_buttons(){this.prop.model&&this.prop.model.length>1&&(this.elements.skin.onclick=()=>{window.loadlive2d("pio",this.prop.model[this.modules_idol()]),this.prop.content.skin&&this.modules_message(this.prop.content.skin[1]||"新衣服真漂亮~")},this.elements.skin.onmouseover=()=>{this.prop.content.skin&&this.modules_message(this.prop.content.skin[0]||"想看看我的新衣服吗？")},this.current.menu.appendChild(this.elements.skin)),this.elements.close.onclick=()=>{this.hide()},this.elements.close.onmouseover=()=>{this.modules_message(this.prop.content.close||"QWQ 下次再见吧~")},this.current.menu.appendChild(this.elements.close)}action_custom(){}create(e,n){const i=document.createElement(e);return n.class&&(i.className=n.class),i}rand(e){return e[Math.floor(Math.random()*e.length+1)-1]}}class Ie{constructor(e){m(this,"hidden");m(this,"position");m(this,"mode");m(this,"content");m(this,"model");e?(this.hidden=e.hidden??!1,this.mode=e.mode??"fixed",this.content={welcome:e.content.welcome,skin:e.content.skin},this.model=e.model):(this.hidden=!1,this.position="left",this.mode="fixed",this.content={welcome:["欢迎使用思源笔记！","今天天气不错，一起来玩吧！"],skin:["想看看我的新衣服吗？","新衣服真漂亮~"]},this.model=["/plugins/siyuan-plugin-kanban-girl/models/416/model.json","/plugins/siyuan-plugin-kanban-girl/models/pio/model.json"])}}/**
 * 负责管理 KanbanGirl 插件设置。
 * @class
 * @license {@link https://opensource.org/licenses/MIT|MIT License}
 * @module SettingManager
 * @see {@link https://github.com/terwer/KanbanGirl}
 * @author terwer
 * @version 1.1.0
 * @since 1.1.0
 */const b=class{static async loadSetting(e){this.logger.debug("Loading setting from storage");let n;try{const i=await e.loadData(b.settingStorage);typeof i=="string"?n=JSON.parse(i):n=i,this.logger.info("Loaded setting from storage",n)}catch{n=new Ie,this.logger.info("Failed to load setting from storage, use default setting: ",n)}return n}static async getSetting(e){return b.setting?(this.logger.debug("Read setting from cache",b.setting),b.setting):(b.setting=await b.loadSetting(e),this.logger.debug("Read setting from storage",b.setting),b.setting)}static async saveSetting(e,n){this.logger.info("Saving setting to storage",n),b.setting=n;const i=JSON.stringify(n);await e.saveData(b.settingStorage,i)}static async removeSetting(e){this.logger.debug("Removing setting from storage"),b.setting=null,await e.removeData(b.settingStorage)}};let $=b;m($,"logger",z("setting-manager","kanban-girl",J)),m($,"settingStorage","kanban-girl-setting.json"),m($,"setting");function Ne(t){let e,n,i,s,a;return{c(){e=h("div"),n=h("div"),i=x(),s=h("canvas"),f(n,"class","pio-action"),f(s,"id","pio"),f(s,"width",Ae),f(s,"height",He),f(s,"class","svelte-1by786t"),f(e,"class",a="pio-container "+t[0])},m(l,r){ue(l,e,r),u(e,n),u(e,i),u(e,s)},p(l,[r]){r&1&&a!==(a="pio-container "+l[0])&&f(e,"class",a)},i:C,o:C,d(l){l&&Q(e)}}}let Ae=320,He=500;function qe(t,e,n){let{pluginInstance:i}=e,s="left";const a=l=>{const r=window,g=new _e(l);g.start(),r.kanbanGirlPio=g,i.logger.info("window.kanbanGirlPio mounted")};return ge(async()=>{const l=await $.getSetting(i);n(0,s=l.position),a(l)}),t.$$set=l=>{"pluginInstance"in l&&n(1,i=l.pluginInstance)},[s,i]}class Be extends pe{constructor(e){super(),fe(this,e,qe,Ne,de,{pluginInstance:1})}}function Fe(t){let e,n,i,s,a,l,r,g,o,c,d,_,v,p,k,S,w,Z,E,V,ee,K,te,y,T,D,M,O,U,ne;return{c(){e=h("div"),n=h("label"),i=h("div"),i.innerHTML=`隐藏看板娘
      <div class="b3-label__text">勾选之后将永久隐藏看板娘，若要显示请取消勾选</div>`,s=x(),a=h("span"),l=x(),r=h("input"),g=x(),o=h("label"),c=h("div"),c.innerHTML=`看板娘位置
      <div class="b3-label__text">该设置决定看办理显示的位置</div>`,d=x(),_=h("span"),v=x(),p=h("select"),k=h("option"),k.textContent="默认",S=h("option"),S.textContent="左边",w=h("option"),w.textContent="右边",Z=x(),E=h("label"),V=h("div"),V.innerHTML=`显示模式
      <div class="b3-label__text">该设置仅影响看板娘能否动态交互以及是否可移动</div>`,ee=x(),K=h("span"),te=x(),y=h("select"),T=h("option"),T.textContent="默认",D=h("option"),D.textContent="静态模式",M=h("option"),M.textContent="固定模式",O=h("option"),O.textContent="拖拽模式",f(i,"class","fn__flex-1"),f(a,"class","fn__space"),f(r,"class","b3-switch fn__flex-center"),f(r,"type","checkbox"),f(n,"class","fn__flex b3-label"),f(c,"class","fn__flex-1"),f(_,"class","fn__space"),k.__value="left",k.value=k.__value,S.__value="left",S.value=S.__value,w.__value="right",w.value=w.__value,f(p,"class","b3-select fn__flex-center fn__size200"),t[1]===void 0&&B(()=>t[8].call(p)),f(o,"class","fn__flex b3-label config__item"),f(V,"class","fn__flex-1"),f(K,"class","fn__space"),T.__value="fixed",T.value=T.__value,D.__value="static",D.value=D.__value,M.__value="fixed",M.value=M.__value,O.__value="draggable",O.value=O.__value,f(y,"class","b3-select fn__flex-center fn__size200"),t[2]===void 0&&B(()=>t[9].call(y)),f(E,"class","fn__flex b3-label config__item"),f(e,"class","config__tab-container"),f(e,"data-name","editor")},m(L,N){ue(L,e,N),u(e,n),u(n,i),u(n,s),u(n,a),u(n,l),u(n,r),r.checked=t[0],u(e,g),u(e,o),u(o,c),u(o,d),u(o,_),u(o,v),u(o,p),u(p,k),u(p,S),u(p,w),j(p,t[1],!0),u(e,Z),u(e,E),u(E,V),u(E,ee),u(E,K),u(E,te),u(E,y),u(y,T),u(y,D),u(y,M),u(y,O),j(y,t[2],!0),U||(ne=[P(r,"change",t[7]),P(r,"change",t[3]),P(p,"change",t[8]),P(p,"change",t[4]),P(y,"change",t[9]),P(y,"change",t[5])],U=!0)},p(L,[N]){N&1&&(r.checked=L[0]),N&2&&j(p,L[1]),N&4&&j(y,L[2])},i:C,o:C,d(L){L&&Q(e),U=!1,F(ne)}}}function Ve(t,e,n){let{pluginInstance:i}=e,s,a,l,r,g;const o=window,c=async()=>{l?a.style.display="none":a.style.display="block",s.hidden=l,await $.saveSetting(i,s),v()},d=async()=>{s.position=r,await $.saveSetting(i,s),window.location.reload()},_=async()=>{s.mode=g,await $.saveSetting(i,s),window.location.reload()},v=()=>{i.logger.info("rebuilding model due to config change..."),delete o.kanbanGirlPio;const w=new _e(s);w.start(),o.kanbanGirlPio=w};ge(async()=>{a=document.getElementById("pioApp"),s=await $.getSetting(i),n(0,l=s.hidden),n(1,r=s.position),n(2,g=s.mode)});function p(){l=this.checked,n(0,l)}function k(){r=se(this),n(1,r)}function S(){g=se(this),n(2,g)}return t.$$set=w=>{"pluginInstance"in w&&n(6,i=w.pluginInstance)},[l,r,g,c,d,_,i,p,k,S]}class je extends pe{constructor(e){super(),fe(this,e,Ve,Fe,de,{pluginInstance:6})}}const Y={iconTopbar:'<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>',iconSwitch:'<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V256c0 17.7 14.3 32 32 32s32-14.3 32-32V32zM143.5 120.6c13.6-11.3 15.4-31.5 4.1-45.1s-31.5-15.4-45.1-4.1C49.7 115.4 16 181.8 16 256c0 132.5 107.5 240 240 240s240-107.5 240-240c0-74.2-33.8-140.6-86.6-184.6c-13.6-11.3-33.8-9.4-45.1 4.1s-9.4 33.8 4.1 45.1c38.9 32.3 63.5 81 63.5 135.4c0 97.2-78.8 176-176 176s-176-78.8-176-176c0-54.4 24.7-103.1 63.5-135.4z"/></svg>'};function ze(t){const e=t.addTopBar({icon:Y.iconTopbar,title:t.i18n.kanbanGirl,position:"right",callback:()=>{}});e.addEventListener("click",async()=>{let n=e.getBoundingClientRect();n.width===0&&(n=document.querySelector("#barMore").getBoundingClientRect()),await Je(t,n)})}const Je=async(t,e)=>{const n=new H.Menu("kanbanGirlMenu"),i=await $.getSetting(t);if(!i.hidden){let s=!i.hidden;const a=document.createElement("span");a.innerHTML=`
  <span class="font-awesome-icon kg-switch-icon">${Y.iconSwitch}</span>
  <span class="b3-menu__label">快速开关</span>
  <label class="switch">
    <input style="box-sizing: border-box"  class="b3-switch fn__flex-center" type="checkbox" ${s?"checked":""}>      
    <span class="slider round"></span>
  </label>
  `;const l=a.querySelector("input"),r=a.querySelector(".slider"),g=()=>{s=!s,l.checked=s,r.classList.toggle("on",s),o()},o=()=>{window.kanbanGirlPio.autoDisplay()};l.addEventListener("click",c=>{c.stopPropagation(),o()}),a.addEventListener("click",g),n.addItem({element:a}),n.addSeparator()}n.addItem({iconHTML:`<span class="font-awesome-icon">${Y.iconTopbar}</span>`,label:t.i18n.setting,click:()=>{be(t)}}),t.isMobile?n.fullscreen():n.open({x:e.right,y:e.bottom,isLeft:!0})},be=t=>{const e="kanban-girl-setting",n=new H.Dialog({title:`${t.i18n.setting} - ${t.i18n.kanbanGirl}`,content:`<div id="${e}"></div>`,width:t.isMobile?"92vw":"720px"});new je({target:document.getElementById(e),props:{pluginInstance:t,dialog:n}})};class Ke{constructor(){m(this,"logger");this.logger=z("base-api","kanban-girl",J)}async sql(e){const n={stmt:e},i="/api/query/sql";return await this.siyuanRequest(i,n)}async siyuanRequest(e,n){const i=`${me}${e}`,s={body:JSON.stringify(n),method:"POST"};return await(await fetch(i,s)).json()}}class Ue extends Ke{async getFile(e,n){const i=await fetch(`${me}/api/file/getFile`,{method:"POST",headers:{Authorization:`Token ${Ge}`},body:JSON.stringify({path:e})});if(i.status===200){if(n==="text")return await i.text();if(n==="json")return await i.json()}return null}}async function We(t,e){const n={method:"POST"};return e&&(n.body=JSON.stringify(e)),await(await fetch(t,n)).text()}async function we(t){let e={path:t},n="/api/file/getFile";try{return await We(n,e)}catch{return null}}function Xe(t,e,n){return new H.Dialog({title:t,content:`
        <div id="dialog" class="b3-typography" style="margin: 2rem; font-size: 1rem">
            ${e}
        </div>`,width:n,height:"50%"})}async function Ye(t,e,n){var i,s;try{let a=e.match(/\d+\.\d+\.\d+/g);if(a===null){console.log(`Failed to parse plugin version: ${e}`);return}let l=a[0],r=(s=(i=window==null?void 0:window.siyuan)==null?void 0:i.config)==null?void 0:s.lang;if(r===void 0){console.log("Get Lang error");return}let g=n??`i18n/CHANGELOG-${r}-${l}.md`;const o=`/data/plugins/${t}/${g}`;let c=await we(o);if(c.match(/"code":404/g)!==null){console.log(`Faild to find changelog file: ${o}`);return}let v=window.Lute.New().Md2HTML(c);return Xe(`${t} v${e}`,v,"60%")}catch(a){console.log("showChangeLog error:",a)}}const ae="PluginVersion";async function Qe(t,e){const n=`/data/plugins/${t.name}/plugin.json`;let i={VersionChanged:void 0,OldVersion:void 0,NewVersion:void 0,Dialog:void 0};try{let s=await we(n);if(s===null)return i;s=JSON.parse(s);let a=s.version;console.log(`${t.name} Ver: ${a}`);let l=await t.loadData(ae);i.OldVersion=l,i.NewVersion=a,i.VersionChanged=!1,a!==l&&(i.VersionChanged=!0,console.log(`${t.name} got new version: ${l} -> ${a}`),t.saveData(ae,a),i.Dialog=await Ye(t.name,a,e))}catch(s){console.error(`Setting load error: ${s}`)}return i}class Ze extends H.Plugin{constructor(n){super(n);m(this,"logger");m(this,"kernelApi");m(this,"isMobile");this.logger=z("index","kanban-girl",J);const i=H.getFrontend();this.isMobile=i==="mobile"||i==="browser-mobile",this.kernelApi=new Ue}async onload(){await this.initDependency(),ze(this),this.initUI()}async onLayoutReady(){await Qe(this)}openSetting(){be(this)}async initDependency(){await import("/plugins/siyuan-plugin-kanban-girl/static/l2d.js");const i="pio-style";if(!document.getElementById(i)){const s=document.createElement("link");s.id=i,s.href="/plugins/siyuan-plugin-kanban-girl/static/pio.css",s.rel="stylesheet",document.head.appendChild(s)}}initUI(){const n="pioApp",i=document.createElement("div");i.id=n,document.body.appendChild(i),new Be({target:document.getElementById(n),props:{pluginInstance:this}})}}module.exports=Ze;
