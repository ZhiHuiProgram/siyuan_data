{"ID":"20251102002917-h1hm9s4","Spec":"1","Type":"NodeDocument","Properties":{"id":"20251102002917-h1hm9s4","title":"Weak 与循环引用","type":"doc","updated":"20251112220611"},"Children":[{"ID":"20251102002917-0nd0d87","Type":"NodeParagraph","Properties":{"id":"20251102002917-0nd0d87","updated":"20251102003601"},"Children":[{"Type":"NodeText","Data":"同时使用 Rc\u003cT\u003e 和 RefCell\u003cT\u003e 创建循环引用，最终这些引用的计数都无法被归零，因此 Rc\u003cT\u003e 拥有的值也不会被释放清理。"}]},{"ID":"20251110224105-p8n0ep0","Type":"NodeParagraph","Properties":{"id":"20251110224105-p8n0ep0","updated":"20251110224106"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​ 引用不计入所有权，因此它"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无法阻止所引用的内存值被释放掉"},{"Type":"NodeText","Data":"，而且 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​ 本身不对值的存在性做任何担保，引用的值还存在就返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Some"},{"Type":"NodeText","Data":"​，不存在就返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"None"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20251110224111-7xzua43","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251110224111-7xzua43","updated":"20251112220611"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://course.rs/advance/circle-self-ref/circle-reference.html#weak-%E4%B8%8E-rc-%E5%AF%B9%E6%AF%94","TextMarkTextContent":"Weak 与 Rc 对比"}]},{"ID":"20251110224111-8jqyxx6","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20251110224111-8jqyxx6","updated":"20251110224111"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Rc"},{"Type":"NodeText","Data":"​"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不计数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用计数"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不拥有所有权"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"拥有值的所有权"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不阻止值被释放(drop)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"所有权计数归零，才能 drop"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用的值存在返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Some"},{"Type":"NodeText","Data":"​，不存在返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"None"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用的值必定存在"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"upgrade"},{"Type":"NodeText","Data":"​ 取到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Option\u0026lt;Rc\u0026lt;T\u0026gt;\u0026gt;"},{"Type":"NodeText","Data":"​，然后再取值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Deref"},{"Type":"NodeText","Data":"​ 自动解引用，取值无需任何操作"}]}]}]},{"ID":"20251112220611-b3d7utc","Type":"NodeParagraph","Properties":{"id":"20251112220611-b3d7utc","updated":"20251112220611"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​ 通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"use std::rc::Weak"},{"Type":"NodeText","Data":"​ 来引入，它具有以下特点:"}]},{"ID":"20251112220611-iaz67rz","Type":"NodeList","ListData":{},"Properties":{"id":"20251112220611-iaz67rz","updated":"20251112220611"},"Children":[{"ID":"20251112220611-oq8w15a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251112220611-oq8w15a","updated":"20251112220611"},"Children":[{"ID":"20251112220611-pygtuv6","Type":"NodeParagraph","Properties":{"id":"20251112220611-pygtuv6","updated":"20251112220611"},"Children":[{"Type":"NodeText","Data":"可访问，但没有所有权，不增加引用计数，因此不会影响被引用值的释放回收"}]}]},{"ID":"20251112220611-qzs0y61","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251112220611-qzs0y61","updated":"20251112220611"},"Children":[{"ID":"20251112220611-ta38a8j","Type":"NodeParagraph","Properties":{"id":"20251112220611-ta38a8j","updated":"20251112220611"},"Children":[{"Type":"NodeText","Data":"可由 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Rc\u0026lt;T\u0026gt;"},{"Type":"NodeText","Data":"​ 调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"downgrade"},{"Type":"NodeText","Data":"​ 方法转换成 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak\u0026lt;T\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20251112220611-0mg1m5n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251112220611-0mg1m5n","updated":"20251112220611"},"Children":[{"ID":"20251112220611-h61vjmb","Type":"NodeParagraph","Properties":{"id":"20251112220611-h61vjmb","updated":"20251112220611"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak\u0026lt;T\u0026gt;"},{"Type":"NodeText","Data":"​ 可使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"upgrade"},{"Type":"NodeText","Data":"​ 方法转换成 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Option\u0026lt;Rc\u0026lt;T\u0026gt;\u0026gt;"},{"Type":"NodeText","Data":"​，如果资源已经被释放，则 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Option"},{"Type":"NodeText","Data":"​ 的值是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"None"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20251112220611-dndqn64","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251112220611-dndqn64","updated":"20251112220611"},"Children":[{"ID":"20251112220611-t9oqc97","Type":"NodeParagraph","Properties":{"id":"20251112220611-t9oqc97","updated":"20251112220611"},"Children":[{"Type":"NodeText","Data":"常用于解决循环引用的问题"}]}]}]},{"ID":"20251112220611-p3zdiuo","Type":"NodeParagraph","Properties":{"id":"20251112220611-p3zdiuo","updated":"20251112220611"}}]}