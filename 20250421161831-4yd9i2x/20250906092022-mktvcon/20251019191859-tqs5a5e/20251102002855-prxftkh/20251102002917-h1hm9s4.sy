{"ID":"20251102002917-h1hm9s4","Spec":"1","Type":"NodeDocument","Properties":{"id":"20251102002917-h1hm9s4","title":"Weak 与循环引用","type":"doc","updated":"20251110224114"},"Children":[{"ID":"20251102002917-0nd0d87","Type":"NodeParagraph","Properties":{"id":"20251102002917-0nd0d87","updated":"20251102003601"},"Children":[{"Type":"NodeText","Data":"同时使用 Rc\u003cT\u003e 和 RefCell\u003cT\u003e 创建循环引用，最终这些引用的计数都无法被归零，因此 Rc\u003cT\u003e 拥有的值也不会被释放清理。"}]},{"ID":"20251110224105-p8n0ep0","Type":"NodeParagraph","Properties":{"id":"20251110224105-p8n0ep0","updated":"20251110224106"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​ 引用不计入所有权，因此它"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无法阻止所引用的内存值被释放掉"},{"Type":"NodeText","Data":"，而且 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​ 本身不对值的存在性做任何担保，引用的值还存在就返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Some"},{"Type":"NodeText","Data":"​，不存在就返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"None"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20251110224111-7xzua43","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251110224111-7xzua43","updated":"20251110224114"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://course.rs/advance/circle-self-ref/circle-reference.html#weak-%E4%B8%8E-rc-%E5%AF%B9%E6%AF%94","TextMarkTextContent":"Weak 与 Rc 对比"}]},{"ID":"20251110224111-8jqyxx6","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20251110224111-8jqyxx6","updated":"20251110224111"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Weak"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Rc"},{"Type":"NodeText","Data":"​"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不计数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用计数"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不拥有所有权"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"拥有值的所有权"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不阻止值被释放(drop)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"所有权计数归零，才能 drop"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用的值存在返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Some"},{"Type":"NodeText","Data":"​，不存在返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"None"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"引用的值必定存在"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"upgrade"},{"Type":"NodeText","Data":"​ 取到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Option\u0026lt;Rc\u0026lt;T\u0026gt;\u0026gt;"},{"Type":"NodeText","Data":"​，然后再取值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Deref"},{"Type":"NodeText","Data":"​ 自动解引用，取值无需任何操作"}]}]}]},{"ID":"20251110224114-kcxlqcv","Type":"NodeParagraph","Properties":{"id":"20251110224114-kcxlqcv","updated":"20251110224114"}}]}