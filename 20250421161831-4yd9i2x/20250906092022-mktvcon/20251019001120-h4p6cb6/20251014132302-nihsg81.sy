{"ID":"20251014132302-nihsg81","Spec":"1","Type":"NodeDocument","Properties":{"id":"20251014132302-nihsg81","title":"认识生命周期","type":"doc","updated":"20251014145707"},"Children":[{"ID":"20251014132302-f9oj4z7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251014132302-f9oj4z7","updated":"20251014134433"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"标注：\n\t\u0026i32        // 一个引用\n\t\u0026'a i32     // 具有显式生命周期的引用\n\t\u0026'a mut i32 // 具有显式生命周期的可变引用\n\t\n\t///生命周期 'a 不代表生命周期等于 'a，而是大于等于 'a\n\tfn longest\u003c'a\u003e(x: \u0026'a str, y: \u0026'a str) -\u003e \u0026'a str {  //返回值的寿命周期和x，y一样\n\t    if x.len() \u003e y.len() {\n\t        x\n\t    } else {\n\t        y\n\t    }\n\t}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251014134254-f3fpevs","Type":"NodeParagraph","Properties":{"id":"20251014134254-f3fpevs","updated":"20251014141726"},"Children":[{"Type":"NodeText","Data":"标注："}]},{"ID":"20251014141738-q5ovcyu","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20251014141738-q5ovcyu","updated":"20251014143627"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"情况"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"是否需要标注"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"单个引用参数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✗ 不需要"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"方法返回引用（有 \u0026self）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✗ 不需要"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"多个引用参数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✓ 需要"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"结构体有引用字段"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✓ 需要."}]}]}]},{"ID":"20251014143627-1arxpl5","Type":"NodeParagraph","Properties":{"id":"20251014143627-1arxpl5","updated":"20251014143635"},"Children":[{"Type":"NodeText","Data":"生命周期的编译规则："}]},{"ID":"20251014143647-4jr4ypp","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251014143647-4jr4ypp","updated":"20251014143647"},"Children":[{"ID":"20251014143647-bkccj1p","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251014143647-bkccj1p","updated":"20251014143647"},"Children":[{"ID":"20251014143647-l11cvub","Type":"NodeParagraph","Properties":{"id":"20251014143647-l11cvub","updated":"20251014143647"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每一个引用参数都会获得独自的生命周期"},{"Type":"NodeText","Data":"\n例如一个引用参数的函数就有一个生命周期标注: "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fn foo\u0026lt;'a\u0026gt;(x: \u0026amp;'a i32)"},{"Type":"NodeText","Data":"​，两个引用参数的有两个生命周期标注:"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fn foo\u0026lt;'a, 'b\u0026gt;(x: \u0026amp;'a i32, y: \u0026amp;'b i32)"},{"Type":"NodeText","Data":"​, 依此类推。"}]}]},{"ID":"20251014143647-kgatrq8","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251014143647-kgatrq8","updated":"20251014143647"},"Children":[{"ID":"20251014143647-hle5ess","Type":"NodeParagraph","Properties":{"id":"20251014143647-hle5ess","updated":"20251014143647"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"若只有一个输入生命周期（函数参数中只有一个引用类型），那么该生命周期会被赋给所有的输出生命周期"},{"Type":"NodeText","Data":"​，也就是所有返回值的生命周期都等于该输入生命周期\n例如函数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fn foo(x: \u0026amp;i32) -\u0026gt; \u0026amp;i32"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"x"},{"Type":"NodeText","Data":"​ 参数的生命周期会被自动赋给返回值 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;i32"},{"Type":"NodeText","Data":"​，因此该函数等同于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fn foo\u0026lt;'a\u0026gt;(x: \u0026amp;'a i32) -\u0026gt; \u0026amp;'a i32"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20251014143647-6ul47bl","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251014143647-6ul47bl","updated":"20251014143647"},"Children":[{"ID":"20251014143647-tv0drek","Type":"NodeParagraph","Properties":{"id":"20251014143647-tv0drek","updated":"20251014143647"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"若存在多个输入生命周期，且其中一个是"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"\u0026amp;self"},{"Type":"NodeText","Data":"​"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"或"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"\u0026amp;mut self"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，则"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"\u0026amp;self"},{"Type":"NodeText","Data":"​"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"的生命周期被赋给所有的输出生命周期"},{"Type":"NodeText","Data":"\n拥有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;self"},{"Type":"NodeText","Data":"​ 形式的参数，说明该函数是一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"方法"},{"Type":"NodeText","Data":"​，该规则让方法的使用便利度大幅提升。"}]}]}]},{"ID":"20251014141851-pzobxw9","Type":"NodeParagraph","Properties":{"id":"20251014141851-pzobxw9","updated":"20251014143338"},"Children":[{"Type":"NodeText","Data":"方法中的生命周期："}]},{"ID":"20251014143338-9ny4e8j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251014143338-9ny4e8j","updated":"20251014143555"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"返回值为self\n\timpl\u003c'a\u003e ImportantExcerpt\u003c'a\u003e {\n\t    fn announce_and_return_part\u003c'b\u003e(\u0026'a self, announcement: \u0026'b str) -\u003e \u0026'a str {  // 这里不需要标注，这是编译器推导的结果\n\t        println!(\"Attention please: {}\", announcement);\t\t\t\t\t\t\t   //\t\t\t\n\t        self.part\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   //\n\t    }\n\t}\n返回值为非self\n\timpl\u003c'a\u003e ImportantExcerpt\u003c'a\u003e {    \t    下面的错误修改----\u003eimpl\u003c'a: 'b, 'b\u003e ImportantExcerpt\u003c'a\u003e   和特征约束一个写法\n\t    fn announce_and_return_part\u003c'b\u003e(\u0026'a self, announcement: \u0026'b str) -\u003e \u0026'b str {   //手动加了一个 ‘b ，编译错误\n\t        println!(\"Attention please: {}\", announcement);\n\t        self.part\n\t    }\n\t}\n\t\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251014143924-cebfh83","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20251014143924-cebfh83","updated":"20251014144714"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://course.rs/basic/lifetime.html#%E9%9D%99%E6%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F","TextMarkTextContent":"静态生命周期"}]},{"ID":"20251014144052-wq87knx","Type":"NodeList","ListData":{},"Properties":{"id":"20251014144052-wq87knx","updated":"20251014144714"},"Children":[{"ID":"20251014144052-xtu5oh0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251014144052-xtu5oh0","updated":"20251014144052"},"Children":[{"ID":"20251014144052-of49ro2","Type":"NodeParagraph","Properties":{"id":"20251014144052-of49ro2","updated":"20251014144052"},"Children":[{"Type":"NodeText","Data":"生命周期 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"'static"},{"Type":"NodeText","Data":"​ 意味着能和程序活得一样久，例如字符串字面量和特征对象"}]}]},{"ID":"20251014144052-4rglz6p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251014144052-4rglz6p","updated":"20251014144714"},"Children":[{"ID":"20251014144052-wyal6hf","Type":"NodeParagraph","Properties":{"id":"20251014144052-wyal6hf","updated":"20251014144703"},"Children":[{"Type":"NodeText","Data":"实在遇到解决不了的生命周期标注问题，可以尝试 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"T: 'static"},{"Type":"NodeText","Data":"​，有时候它会给你奇迹"}]},{"ID":"20251014144706-0imu9jw","Type":"NodeParagraph","Properties":{"id":"20251014144706-0imu9jw","updated":"20251014144714"},"Children":[{"Type":"NodeText","Data":"一个是引用一个是约束"}]}]}]},{"ID":"20251014143925-2meha4d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251014143925-2meha4d","updated":"20251014143932"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"let s: \u0026'static str = \"我没啥优点，就是活得久，嘿嘿\";\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251014145659-ad3kv7e","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20251014145659-ad3kv7e","updated":"20251014145707"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://course.rs/basic/lifetime.html#%E4%B8%80%E4%B8%AA%E5%A4%8D%E6%9D%82%E4%BE%8B%E5%AD%90-%E6%B3%9B%E5%9E%8B%E7%89%B9%E5%BE%81%E7%BA%A6%E6%9D%9F","TextMarkTextContent":"一个复杂例子: 泛型、特征约束"}]},{"ID":"20251014145700-h7ovsqr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251014145700-h7ovsqr","updated":"20251014145707"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"use std::fmt::Display;\n\nfn longest_with_an_announcement\u003c'a, T\u003e(\n    x: \u0026'a str,\n    y: \u0026'a str,\n    ann: T,\n) -\u003e \u0026'a str\nwhere\n    T: Display,\n{\n    println!(\"Announcement! {}\", ann);\n    if x.len() \u003e y.len() {\n        x\n    } else {\n        y\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}