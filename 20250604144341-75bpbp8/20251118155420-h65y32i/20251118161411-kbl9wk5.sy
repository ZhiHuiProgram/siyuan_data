{"ID":"20251118161411-kbl9wk5","Spec":"1","Type":"NodeDocument","Properties":{"id":"20251118161411-kbl9wk5","title":"MBR分区表","type":"doc","updated":"20251118161423"},"Children":[{"ID":"20251118161423-bmzthal","Type":"NodeParagraph","Properties":{"id":"20251118161423-bmzthal","updated":"20251118161423"},"Children":[{"Type":"NodeText","Data":"详细结构图"}]},{"ID":"20251118161423-000g6fo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118161423-000g6fo","updated":"20251118161423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"MBR (512 字节)\n┌─────────────────────────────────────────────┐\n│  0x000 - 0x1BD: 引导代码 (446 字节)          │\n│  ├─ 引导加载程序代码                          │\n│  └─ 错误消息字符串                            │\n├─────────────────────────────────────────────┤\n│  0x1BE - 0x1CD: 分区表项 1 (16 字节)         │\n├─────────────────────────────────────────────┤\n│  0x1CE - 0x1DD: 分区表项 2 (16 字节)         │\n├─────────────────────────────────────────────┤\n│  0x1DE - 0x1ED: 分区表项 3 (16 字节)         │\n├─────────────────────────────────────────────┤\n│  0x1EE - 0x1FD: 分区表项 4 (16 字节)         │\n├─────────────────────────────────────────────┤\n│  0x1FE - 0x1FF: 魔数 0x55 0xAA (2 字节)      │\n└─────────────────────────────────────────────┘\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118161423-1noerhd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118161423-1noerhd","updated":"20251118161423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"偏移量   大小   说明\n0x000    3     跳转指令 (JMP SHORT + NOP)\n0x003    8     OEM ID (厂商标识)\n0x00B    25    BPB (BIOS Parameter Block) - 可选\n0x024    ~400  引导加载程序代码\n~0x1B0   ~14   磁盘签名和保留区域\n0x1B8    4     磁盘签名 (Disk Signature)\n0x1BC    2     保留 (通常为 0x0000)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118161423-hx3oohl","Type":"NodeParagraph","Properties":{"id":"20251118161423-hx3oohl","updated":"20251118161423"},"Children":[{"Type":"NodeText","Data":"详细字段说明:嵌入式设备前引导代码全归零即可，引导在uboot0"}]},{"ID":"20251118161423-d4mnmon","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118161423-d4mnmon","updated":"20251118161423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"┌─────────────────────────────────────────────────┐\n│ 0x000 - 0x002: 跳转指令 (3 字节)                 │\n│   EB 3C 90  (JMP SHORT 0x3E; NOP)               │\n│   跳过头部数据，直接执行引导代码                  │\n├─────────────────────────────────────────────────┤\n│ 0x003 - 0x00A: OEM ID (8 字节)                  │\n│   厂商标识字符串，如 \"MSWIN4.1\" 或 \"SYSLINUX\"    │\n├─────────────────────────────────────────────────┤\n│ 0x00B - 0x023: BPB (BIOS Parameter Block)       │\n│   ├─ 0x00B: 每扇区字节数 (2 字节, 通常 512)      │\n│   ├─ 0x00D: 每簇扇区数 (1 字节)                  │\n│   ├─ 0x00E: 保留扇区数 (2 字节)                  │\n│   ├─ 0x010: FAT 表数量 (1 字节)                  │\n│   ├─ 0x011: 根目录项数 (2 字节)                  │\n│   └─ ... (其他 BPB 字段)                         │\n│   注: 这部分在硬盘 MBR 中常被引导代码占用         │\n├─────────────────────────────────────────────────┤\n│ 0x024 - 0x1B7: 引导代码主体 (~400 字节)          │\n│   ├─ 加载第二阶段引导程序                         │\n│   ├─ 错误处理代码                                │\n│   └─ 错误消息字符串 (如 \"Missing OS\")            │\n├─────────────────────────────────────────────────┤\n│ 0x1B8 - 0x1BB: 磁盘签名 (4 字节)                │\n│   唯一标识此磁盘的 ID，Windows 用于识别磁盘      │\n├─────────────────────────────────────────────────┤\n│ 0x1BC - 0x1BD: 保留/复制保护标志 (2 字节)       │\n│   通常为 0x0000，历史遗留                        │\n└─────────────────────────────────────────────────┘\n\n引导代码的几种处理方式\n方式 1：全部置零（最简单，推荐）\nmbr[0:446] = b'\\x00' * 446\n方式 2：简单的跳转（可选，但没必要）\n# 只是形式上的，实际不会执行\nmbr[0:3] = b'\\xEB\\xFE\\x90'  # JMP $ (死循环); NOP\n方式 3：添加 OEM ID（美观，但无实际作用）\nmbr[0:3] = b'\\xEB\\x3C\\x90'\nmbr[3:11] = b'UBOOT   '  # OEM ID\n‍```\n\n## 2. CHS 地址 - 不需要设置！\n\n**重要结论：现代系统（包括嵌入式）完全不使用 CHS 地址！**\n\n### CHS vs LBA\n‍```\nCHS (Cylinder-Head-Sector):\n- 古老的寻址方式\n- 有几何限制（最大 8GB）\n- 现代系统已废弃\n\nLBA (Logical Block Addressing):\n- 现代寻址方式\n- 简单的线性扇区号\n- U-Boot、Linux 都只用 LBA\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118161423-l2ocgpj","Type":"NodeParagraph","Properties":{"id":"20251118161423-l2ocgpj","updated":"20251118161423"},"Children":[{"Type":"NodeText","Data":"分区表项结构（16字节）"}]},{"ID":"20251118161423-7qdfbuq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118161423-7qdfbuq","updated":"20251118161423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"偏移  大小  字段名              说明\n+0    1     Boot Indicator     引导标志 (0x80=可引导, 0x00=不可引导)\n+1    3     Starting CHS       起始 CHS 地址 (已过时)\n+4    1     Partition Type     分区类型 (如 0x83=Linux, 0x0C=FAT32)\n+5    3     Ending CHS         结束 CHS 地址 (已过时)\n+8    4     Starting LBA       起始扇区号 (LBA地址, 小端序)\n+12   4     Size in Sectors    分区大小(扇区数, 小端序)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118161423-dtk70lq","Type":"NodeParagraph","Properties":{"id":"20251118161423-dtk70lq","updated":"20251118161423"},"Children":[{"Type":"NodeText","Data":"字段详解："}]},{"ID":"20251118161423-dpvysyd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118161423-dpvysyd","updated":"20251118161423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aWZjb25maWc="},{"Type":"NodeCodeBlockCode","Data":"字节 0: 引导标志\n  0x80 = 可引导分区\n  0x00 = 不可引导\n\n字节 1-3: 起始 CHS (Cylinder-Head-Sector)\n  [已过时，现代系统使用 LBA]\n  \n字节 4: 分区类型\n  0x00 = 空\n  0x0C = FAT32 LBA\n  0x83 = Linux 文件系统\n  0x82 = Linux Swap\n  0x05 = 扩展分区\n  0x0F = 扩展分区 LBA\n  0x07 = NTFS/exFAT\n  \n字节 5-7: 结束 CHS\n  [已过时]\n  \n字节 8-11: 起始 LBA (小端序)\n  分区的起始扇区号\n  \n字节 12-15: 扇区数 (小端序)\n  分区包含的扇区数量\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118161423-lrcbbxe","Type":"NodeParagraph","Properties":{"id":"20251118161423-lrcbbxe","updated":"20251118161423"}}]}